<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>ì¬ê³  ì˜ˆì¸¡ ëŒ€ì‹œë³´ë“œ</title>
  <script crossorigin src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
  <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
  <script src="https://cdn.tailwindcss.com"></script>
  <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
  <style>
    /* Lucide ì•„ì´ì½˜ SVG ìŠ¤íƒ€ì¼ */
    .icon { width: 1em; height: 1em; stroke-width: 2; stroke: currentColor; fill: none; stroke-linecap: round; stroke-linejoin: round; }
  </style>
</head>
<body>
  <div id="root"></div>

  <script type="text/babel">
    const { useState, useEffect, useMemo } = React;

    // íƒ€ì… ì •ì˜
    const StockLevel = {
      SAFE: 'SAFE',
      WARNING: 'WARNING',
      CRITICAL: 'CRITICAL',
      OUT_OF_STOCK: 'OUT_OF_STOCK'
    };

    // ìƒìˆ˜
    const WAREHOUSE_STOCK = {
      '07SBD': 116,
      '07YEL': 21,
      '43LDL': 0,
      '43PKL': 59,
      '50BKS': 66,
      '50CRS': 53,
      '50NYS': 372,
    };

    const REORDER_SCHEDULE = {
      '50BKS': [
        { date: '2025-12-17', quantity: 2520 },
        { date: '2025-12-23', quantity: 6000 },
        { date: '2026-01-08', quantity: 7000 },
        { date: '2026-01-15', quantity: 2000 },
      ],
      '50CRS': [
        { date: '2025-12-24', quantity: 6000 },
        { date: '2026-01-08', quantity: 3000 },
        { date: '2026-01-15', quantity: 1000 },
      ],
      '43PKL': [
        { date: '2025-12-25', quantity: 1000 },
      ],
      '07SBD': [
        { date: '2025-12-24', quantity: 1000 },
      ],
    };

    const extractColorCode = (productName) => {
      const match = productName.match(/\(([A-Z0-9]+)\)$/);
      return match ? match[1] : null;
    };

    // JSON ë°ì´í„° (ì¸ë¼ì¸)
    const ALL_STORES_DATA = {
      "stores": [{
        "storeCode": "ALL",
        "storeName": "ì „ì²´",
        "district": "ì „ì²´",
        "products": [
          {"id": "MB_COLOR_43PKL", "name": "3ABNB1156 (43PKL)", "category": "ë¹„ë‹ˆ", "currentStock": 1221, "price": 43000, "salesHistory": [{"date": "1899-12-29", "quantity": 516}]},
          {"id": "MB_COLOR_50BKS", "name": "3ABNB1156 (50BKS)", "category": "ë¹„ë‹ˆ", "currentStock": 3687, "price": 43000, "salesHistory": [{"date": "1899-12-29", "quantity": 500}]},
          {"id": "MB_COLOR_50CRS", "name": "3ABNB1156 (50CRS)", "category": "ë¹„ë‹ˆ", "currentStock": 4093, "price": 43000, "salesHistory": [{"date": "1899-12-29", "quantity": 656}]},
          {"id": "MB_COLOR_50NYS", "name": "3ABNB1156 (50NYS)", "category": "ë¹„ë‹ˆ", "currentStock": 2040, "price": 43000, "salesHistory": [{"date": "1899-12-29", "quantity": 628}]},
          {"id": "MB_COLOR_07SBD", "name": "3ABNB1156 (07SBD)", "category": "ë¹„ë‹ˆ", "currentStock": 1703, "price": 43000, "salesHistory": [{"date": "1899-12-29", "quantity": 394}]},
          {"id": "MB_COLOR_07YEL", "name": "3ABNB1156 (07YEL)", "category": "ë¹„ë‹ˆ", "currentStock": 1094, "price": 43000, "salesHistory": [{"date": "1899-12-29", "quantity": 113}]}
        ]
      }],
      "districts": [{
        "districtName": "ì „ì²´",
        "stores": [{
          "storeCode": "ALL",
          "storeName": "ì „ì²´",
          "district": "ì „ì²´",
          "products": [
            {"id": "MB_COLOR_43PKL", "name": "3ABNB1156 (43PKL)", "category": "ë¹„ë‹ˆ", "currentStock": 1221, "price": 43000, "salesHistory": [{"date": "1899-12-29", "quantity": 516}]},
            {"id": "MB_COLOR_50BKS", "name": "3ABNB1156 (50BKS)", "category": "ë¹„ë‹ˆ", "currentStock": 3687, "price": 43000, "salesHistory": [{"date": "1899-12-29", "quantity": 500}]},
            {"id": "MB_COLOR_50CRS", "name": "3ABNB1156 (50CRS)", "category": "ë¹„ë‹ˆ", "currentStock": 4093, "price": 43000, "salesHistory": [{"date": "1899-12-29", "quantity": 656}]},
            {"id": "MB_COLOR_50NYS", "name": "3ABNB1156 (50NYS)", "category": "ë¹„ë‹ˆ", "currentStock": 2040, "price": 43000, "salesHistory": [{"date": "1899-12-29", "quantity": 628}]},
            {"id": "MB_COLOR_07SBD", "name": "3ABNB1156 (07SBD)", "category": "ë¹„ë‹ˆ", "currentStock": 1703, "price": 43000, "salesHistory": [{"date": "1899-12-29", "quantity": 394}]},
            {"id": "MB_COLOR_07YEL", "name": "3ABNB1156 (07YEL)", "category": "ë¹„ë‹ˆ", "currentStock": 1094, "price": 43000, "salesHistory": [{"date": "1899-12-29", "quantity": 113}]}
          ]
        }]
      }]
    };

    const MIYAWNG_BINI_DATA = [{"id": "MB_1765843970299_1", "name": "í”ŒëŸ¬ì‹œ ë¯¸ì•¼ì˜¹ ë¹„ë‹ˆ (07SBD)", "category": "ë¹„ë‹ˆ", "currentStock": 108, "price": 43000, "salesHistory": [{"date": "2025-10-23", "quantity": 81}, {"date": "2025-10-24", "quantity": 71}, {"date": "2025-10-25", "quantity": 111}, {"date": "2025-10-26", "quantity": 10}, {"date": "2025-10-27", "quantity": 7}, {"date": "2025-10-28", "quantity": 14}, {"date": "2025-10-29", "quantity": 11}, {"date": "2025-10-30", "quantity": 19}, {"date": "2025-10-31", "quantity": 83}, {"date": "2025-11-01", "quantity": 68}, {"date": "2025-11-02", "quantity": 12}, {"date": "2025-11-03", "quantity": 25}, {"date": "2025-11-04", "quantity": 19}, {"date": "2025-11-05", "quantity": 13}, {"date": "2025-11-06", "quantity": 11}, {"date": "2025-11-07", "quantity": 14}, {"date": "2025-11-08", "quantity": 4}, {"date": "2025-11-09", "quantity": 3}, {"date": "2025-11-10", "quantity": 5}, {"date": "2025-11-11", "quantity": 1}, {"date": "2025-11-12", "quantity": 2}, {"date": "2025-11-13", "quantity": 2}, {"date": "2025-11-14", "quantity": 2}, {"date": "2025-11-15", "quantity": 2}, {"date": "2025-11-16", "quantity": 0}, {"date": "2025-11-17", "quantity": 0}, {"date": "2025-11-18", "quantity": 1}, {"date": "2025-11-19", "quantity": 3}, {"date": "2025-11-20", "quantity": 1}, {"date": "2025-11-21", "quantity": 3}]}, {"id": "MB_1765843970299_2", "name": "í”ŒëŸ¬ì‹œ ë¯¸ì•¼ì˜¹ ë¹„ë‹ˆ (43PKL)", "category": "ë¹„ë‹ˆ", "currentStock": 131, "price": 43000, "salesHistory": [{"date": "2025-10-23", "quantity": 25}, {"date": "2025-10-24", "quantity": 95}, {"date": "2025-10-25", "quantity": 10}, {"date": "2025-10-26", "quantity": 3}, {"date": "2025-10-27", "quantity": 14}, {"date": "2025-10-28", "quantity": 13}, {"date": "2025-10-29", "quantity": 9}, {"date": "2025-10-30", "quantity": 4}, {"date": "2025-10-31", "quantity": 127}, {"date": "2025-11-01", "quantity": 51}, {"date": "2025-11-02", "quantity": 10}, {"date": "2025-11-03", "quantity": 20}, {"date": "2025-11-04", "quantity": 28}, {"date": "2025-11-05", "quantity": 8}, {"date": "2025-11-06", "quantity": 13}, {"date": "2025-11-07", "quantity": 18}, {"date": "2025-11-08", "quantity": 8}, {"date": "2025-11-09", "quantity": 9}, {"date": "2025-11-10", "quantity": 10}, {"date": "2025-11-11", "quantity": 22}, {"date": "2025-11-12", "quantity": 3}, {"date": "2025-11-13", "quantity": 2}, {"date": "2025-11-14", "quantity": 15}, {"date": "2025-11-15", "quantity": 8}, {"date": "2025-11-16", "quantity": 1}, {"date": "2025-11-17", "quantity": 4}, {"date": "2025-11-18", "quantity": 5}, {"date": "2025-11-19", "quantity": 2}, {"date": "2025-11-20", "quantity": 12}, {"date": "2025-11-21", "quantity": 12}]}, {"id": "MB_1765843970299_3", "name": "í”ŒëŸ¬ì‹œ ë¯¸ì•¼ì˜¹ ë¹„ë‹ˆ (50BKS)", "category": "ë¹„ë‹ˆ", "currentStock": -16, "price": 43000, "salesHistory": [{"date": "2025-10-23", "quantity": 145}, {"date": "2025-10-24", "quantity": 294}, {"date": "2025-10-25", "quantity": 226}, {"date": "2025-10-26", "quantity": 54}, {"date": "2025-10-27", "quantity": 119}, {"date": "2025-10-28", "quantity": 84}, {"date": "2025-10-29", "quantity": 127}, {"date": "2025-10-30", "quantity": 65}, {"date": "2025-10-31", "quantity": 502}, {"date": "2025-11-01", "quantity": 41}, {"date": "2025-11-02", "quantity": 1}, {"date": "2025-11-03", "quantity": 4}, {"date": "2025-11-04", "quantity": 8}, {"date": "2025-11-05", "quantity": 0}, {"date": "2025-11-06", "quantity": 0}, {"date": "2025-11-07", "quantity": -1}, {"date": "2025-11-08", "quantity": 1}, {"date": "2025-11-09", "quantity": 0}, {"date": "2025-11-10", "quantity": 0}, {"date": "2025-11-11", "quantity": 0}, {"date": "2025-11-12", "quantity": 0}, {"date": "2025-11-13", "quantity": 0}, {"date": "2025-11-14", "quantity": 0}, {"date": "2025-11-15", "quantity": 0}, {"date": "2025-11-16", "quantity": 0}, {"date": "2025-11-17", "quantity": 0}, {"date": "2025-11-18", "quantity": 0}, {"date": "2025-11-19", "quantity": 0}, {"date": "2025-11-20", "quantity": 120}, {"date": "2025-11-21", "quantity": 122}]}, {"id": "MB_1765843970299_4", "name": "í”ŒëŸ¬ì‹œ ë¯¸ì•¼ì˜¹ ë¹„ë‹ˆ (50CRS)", "category": "ë¹„ë‹ˆ", "currentStock": 94, "price": 43000, "salesHistory": [{"date": "2025-10-23", "quantity": 111}, {"date": "2025-10-24", "quantity": 79}, {"date": "2025-10-25", "quantity": 189}, {"date": "2025-10-26", "quantity": 18}, {"date": "2025-10-27", "quantity": 44}, {"date": "2025-10-28", "quantity": 28}, {"date": "2025-10-29", "quantity": 31}, {"date": "2025-10-30", "quantity": 107}, {"date": "2025-10-31", "quantity": 351}, {"date": "2025-11-01", "quantity": 81}, {"date": "2025-11-02", "quantity": 1}, {"date": "2025-11-03", "quantity": 27}, {"date": "2025-11-04", "quantity": 27}, {"date": "2025-11-05", "quantity": 0}, {"date": "2025-11-06", "quantity": 0}, {"date": "2025-11-07", "quantity": 0}, {"date": "2025-11-08", "quantity": 0}, {"date": "2025-11-09", "quantity": 0}, {"date": "2025-11-10", "quantity": 0}, {"date": "2025-11-11", "quantity": 0}, {"date": "2025-11-12", "quantity": 0}, {"date": "2025-11-13", "quantity": 0}, {"date": "2025-11-14", "quantity": 0}, {"date": "2025-11-15", "quantity": 0}, {"date": "2025-11-16", "quantity": 0}, {"date": "2025-11-17", "quantity": 0}, {"date": "2025-11-18", "quantity": 0}, {"date": "2025-11-19", "quantity": 0}, {"date": "2025-11-20", "quantity": 180}, {"date": "2025-11-21", "quantity": 124}]}, {"id": "MB_1765843970299_5", "name": "í”ŒëŸ¬ì‹œ ë¯¸ì•¼ì˜¹ ë¹„ë‹ˆ (50NYS)", "category": "ë¹„ë‹ˆ", "currentStock": 183, "price": 43000, "salesHistory": [{"date": "2025-10-23", "quantity": 116}, {"date": "2025-10-24", "quantity": 8}, {"date": "2025-10-25", "quantity": 54}, {"date": "2025-10-26", "quantity": 5}, {"date": "2025-10-27", "quantity": 4}, {"date": "2025-10-28", "quantity": 89}, {"date": "2025-10-29", "quantity": 4}, {"date": "2025-10-30", "quantity": 15}, {"date": "2025-10-31", "quantity": 80}, {"date": "2025-11-01", "quantity": 9}, {"date": "2025-11-02", "quantity": 2}, {"date": "2025-11-03", "quantity": 11}, {"date": "2025-11-04", "quantity": 6}, {"date": "2025-11-05", "quantity": 2}, {"date": "2025-11-06", "quantity": 4}, {"date": "2025-11-07", "quantity": 2}, {"date": "2025-11-08", "quantity": 3}, {"date": "2025-11-09", "quantity": 5}, {"date": "2025-11-10", "quantity": 0}, {"date": "2025-11-11", "quantity": 0}, {"date": "2025-11-12", "quantity": 0}, {"date": "2025-11-13", "quantity": 0}, {"date": "2025-11-14", "quantity": 0}, {"date": "2025-11-15", "quantity": 0}, {"date": "2025-11-16", "quantity": 0}, {"date": "2025-11-17", "quantity": 0}, {"date": "2025-11-18", "quantity": 0}, {"date": "2025-11-19", "quantity": 0}, {"date": "2025-11-20", "quantity": 1}, {"date": "2025-11-21", "quantity": 3}]}, {"id": "MB_1765843970314_132", "name": "í”ŒëŸ¬ì‹œ ë¯¸ì•¼ì˜¹ ë¹„ë‹ˆ (07YEL)", "category": "ë¹„ë‹ˆ", "currentStock": 12, "price": 43000, "salesHistory": [{"date": "2025-10-23", "quantity": 0}, {"date": "2025-10-24", "quantity": 0}, {"date": "2025-10-25", "quantity": 0}, {"date": "2025-10-26", "quantity": 0}, {"date": "2025-10-27", "quantity": 0}, {"date": "2025-10-28", "quantity": 0}, {"date": "2025-10-29", "quantity": 0}, {"date": "2025-10-30", "quantity": 0}, {"date": "2025-10-31", "quantity": 0}, {"date": "2025-11-01", "quantity": 0}, {"date": "2025-11-02", "quantity": 0}, {"date": "2025-11-03", "quantity": 0}, {"date": "2025-11-04", "quantity": 0}, {"date": "2025-11-05", "quantity": 0}, {"date": "2025-11-06", "quantity": 0}, {"date": "2025-11-07", "quantity": 0}, {"date": "2025-11-08", "quantity": 0}, {"date": "2025-11-09", "quantity": 0}, {"date": "2025-11-10", "quantity": 0}, {"date": "2025-11-11", "quantity": 0}, {"date": "2025-11-12", "quantity": 0}, {"date": "2025-11-13", "quantity": 0}, {"date": "2025-11-14", "quantity": 0}, {"date": "2025-11-15", "quantity": 0}, {"date": "2025-11-16", "quantity": 0}, {"date": "2025-11-17", "quantity": 0}, {"date": "2025-11-18", "quantity": 0}, {"date": "2025-11-19", "quantity": 0}, {"date": "2025-11-20", "quantity": 0}, {"date": "2025-11-21", "quantity": -1}]}];

    // ìœ í‹¸ë¦¬í‹° í•¨ìˆ˜
    const aggregateAllStoresData = (storesData, originalProducts) => {
      const aggregatedMap = new Map();
      storesData.forEach(store => {
        store.products.forEach(storeProduct => {
          const productKey = storeProduct.name;
          if (!aggregatedMap.has(productKey)) {
            const originalProduct = originalProducts.find(p => p.name === productKey);
            const colorCode = extractColorCode(productKey);
            let reorderSchedule = colorCode ? REORDER_SCHEDULE[colorCode] : (originalProduct?.reorderSchedule || undefined);
            if (!reorderSchedule && colorCode) {
              const upperColorCode = colorCode.toUpperCase();
              if (upperColorCode !== colorCode && REORDER_SCHEDULE[upperColorCode]) {
                reorderSchedule = REORDER_SCHEDULE[upperColorCode];
              }
            }
            aggregatedMap.set(productKey, {
              id: originalProduct?.id || storeProduct.id || `MB_${Date.now()}_${productKey}`,
              name: productKey,
              category: storeProduct.category || 'ë¹„ë‹ˆ',
              currentStock: storeProduct.currentStock > 0 ? storeProduct.currentStock : (originalProduct?.currentStock || 0),
              price: originalProduct?.price || storeProduct.price || 0,
              salesHistory: [],
              warehouseStock: originalProduct?.warehouseStock,
              reorderSchedule: reorderSchedule,
            });
          }
          const aggregatedProduct = aggregatedMap.get(productKey);
          const salesMap = new Map();
          aggregatedProduct.salesHistory.forEach(sale => {
            salesMap.set(sale.date, sale.quantity);
          });
          storeProduct.salesHistory.forEach(sale => {
            const existingQty = salesMap.get(sale.date) || 0;
            salesMap.set(sale.date, existingQty + sale.quantity);
          });
          aggregatedProduct.salesHistory = Array.from(salesMap.entries())
            .map(([date, quantity]) => ({ date, quantity }))
            .sort((a, b) => a.date.localeCompare(b.date));
        });
      });
      return Array.from(aggregatedMap.values());
    };

    // ì•„ì´ì½˜ ì»´í¬ë„ŒíŠ¸ (ê°„ë‹¨í•œ SVG)
    const LayoutDashboard = ({ className }) => React.createElement('svg', { className, viewBox: '0 0 24 24' }, React.createElement('rect', { x: 3, y: 3, width: 7, height: 9 }), React.createElement('rect', { x: 14, y: 3, width: 7, height: 5 }), React.createElement('rect', { x: 14, y: 12, width: 7, height: 9 }), React.createElement('rect', { x: 3, y: 16, width: 7, height: 5 }));
    const Package = ({ className }) => React.createElement('svg', { className, viewBox: '0 0 24 24' }, React.createElement('path', { d: 'M12.89 1.45l8 4A2 2 0 0122 7.24v9.53a2 2 0 01-1.11 1.79l-8 4a2 2 0 01-1.78 0l-8-4a2 2 0 01-1.11-1.8V7.24a2 2 0 011.11-1.81l8-4a2 2 0 011.78 0z' }), React.createElement('polyline', { points: '2.32 6.16 12 11 21.68 6.16' }), React.createElement('line', { x1: 12, y1: 22.76, x2: 12, y2: 11 }));
    const AlertCircle = ({ className }) => React.createElement('svg', { className, viewBox: '0 0 24 24' }, React.createElement('circle', { cx: 12, cy: 12, r: 10 }), React.createElement('line', { x1: 12, y1: 8, x2: 12, y2: 12 }), React.createElement('line', { x1: 12, y1: 16, x2: 12.01, y2: 16 }));
    const Plus = ({ className }) => React.createElement('svg', { className, viewBox: '0 0 24 24' }, React.createElement('line', { x1: 12, y1: 5, x2: 12, y2: 19 }), React.createElement('line', { x1: 5, y1: 12, x2: 19, y2: 12 }));
    const Trash2 = ({ className }) => React.createElement('svg', { className, viewBox: '0 0 24 24' }, React.createElement('polyline', { points: '3 6 5 6 21 6' }), React.createElement('path', { d: 'M19 6v14a2 2 0 01-2 2H7a2 2 0 01-2-2V6m3 0V4a2 2 0 012-2h4a2 2 0 012 2v2' }));
    const Upload = ({ className }) => React.createElement('svg', { className, viewBox: '0 0 24 24' }, React.createElement('path', { d: 'M21 15v4a2 2 0 01-2 2H5a2 2 0 01-2-2v-4' }), React.createElement('polyline', { points: '17 8 12 3 7 8' }), React.createElement('line', { x1: 12, y1: 3, x2: 12, y2: 15 }));
    const X = ({ className }) => React.createElement('svg', { className, viewBox: '0 0 24 24' }, React.createElement('line', { x1: 18, y1: 6, x2: 6, y2: 18 }), React.createElement('line', { x1: 6, y1: 6, x2: 18, y2: 18 }));
    const CheckCircle2 = ({ className }) => React.createElement('svg', { className, viewBox: '0 0 24 24' }, React.createElement('path', { d: 'M22 11.08V12a10 10 0 11-5.93-9.14' }), React.createElement('polyline', { points: '22 4 12 14.01 9 11.01' }));
    const AlertTriangle = ({ className }) => React.createElement('svg', { className, viewBox: '0 0 24 24' }, React.createElement('path', { d: 'M10.29 3.86L1.82 18a2 2 0 001.71 3h16.94a2 2 0 001.71-3L13.71 3.86a2 2 0 00-3.42 0z' }), React.createElement('line', { x1: 12, y1: 9, x2: 12, y2: 13 }), React.createElement('line', { x1: 12, y1: 17, x2: 12.01, y2: 17 }));
    const XCircle = ({ className }) => React.createElement('svg', { className, viewBox: '0 0 24 24' }, React.createElement('circle', { cx: 12, cy: 12, r: 10 }), React.createElement('line', { x1: 15, y1: 9, x2: 9, y2: 15 }), React.createElement('line', { x1: 9, y1: 9, x2: 15, y2: 15 }));
    const Sparkles = ({ className }) => React.createElement('svg', { className, viewBox: '0 0 24 24' }, React.createElement('path', { d: 'M12 2v4M12 18v4M4.93 4.93l2.83 2.83M16.24 16.24l2.83 2.83M2 12h4M18 12h4M4.93 19.07l2.83-2.83M16.24 7.76l2.83-2.83' }));
    const Loader2 = ({ className }) => React.createElement('svg', { className, viewBox: '0 0 24 24', style: { animation: 'spin 1s linear infinite' } }, React.createElement('circle', { cx: 12, cy: 12, r: 10, stroke: 'currentColor', strokeWidth: 4, fill: 'none', opacity: 0.25 }), React.createElement('path', { fill: 'currentColor', d: 'M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z' }));
    const RefreshCw = ({ className }) => React.createElement('svg', { className, viewBox: '0 0 24 24' }, React.createElement('polyline', { points: '23 4 23 10 17 10' }), React.createElement('polyline', { points: '1 20 1 14 7 14' }), React.createElement('path', { d: 'M3.51 9a9 9 0 0114.85 3.36L23 10M1 14l4.64 4.36A9 9 0 0020.49 15' }));

    // StockStatusBadge ì»´í¬ë„ŒíŠ¸
    const StockStatusBadge = ({ status }) => {
      const config = {
        [StockLevel.SAFE]: { color: 'bg-emerald-100 text-emerald-800', text: 'ì—¬ìœ ', Icon: CheckCircle2 },
        [StockLevel.WARNING]: { color: 'bg-amber-100 text-amber-800', text: 'ì£¼ì˜', Icon: AlertTriangle },
        [StockLevel.CRITICAL]: { color: 'bg-rose-100 text-rose-800', text: 'ìœ„í—˜', Icon: AlertCircle },
        [StockLevel.OUT_OF_STOCK]: { color: 'bg-gray-100 text-gray-800', text: 'í’ˆì ˆ', Icon: XCircle },
      };
      const { color, text, Icon } = config[status] || config[StockLevel.SAFE];
      return React.createElement('span', { className: `inline-flex items-center gap-1.5 px-2.5 py-0.5 rounded-full text-xs font-medium ${color}` },
        React.createElement(Icon, { className: 'w-3.5 h-3.5' }),
        text
      );
    };

    // InventoryTable ì»´í¬ë„ŒíŠ¸
    const InventoryTable = ({ products, onSelectProduct, selectedProductId }) => {
      const sortedProducts = [...products].sort((a, b) => {
        const priority = { [StockLevel.OUT_OF_STOCK]: 0, [StockLevel.CRITICAL]: 1, [StockLevel.WARNING]: 2, [StockLevel.SAFE]: 3 };
        return priority[a.status] - priority[b.status] || a.daysUntilEmpty - b.daysUntilEmpty;
      });
      const getBarColor = (status) => {
        switch (status) {
          case StockLevel.SAFE: return 'bg-emerald-500';
          case StockLevel.WARNING: return 'bg-amber-500';
          case StockLevel.CRITICAL: return 'bg-rose-500';
          case StockLevel.OUT_OF_STOCK: return 'bg-gray-300';
          default: return 'bg-gray-300';
        }
      };
      return React.createElement('div', { className: 'bg-white rounded-xl shadow-sm border border-gray-200 overflow-hidden flex flex-col h-full' },
        React.createElement('div', { className: 'overflow-x-auto flex-1' },
          React.createElement('table', { className: 'min-w-full divide-y divide-gray-200' },
            React.createElement('thead', { className: 'bg-gray-50' },
              React.createElement('tr', {},
                React.createElement('th', { scope: 'col', className: 'px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider' }, 'ìƒí’ˆëª… / ì¹´í…Œê³ ë¦¬'),
                React.createElement('th', { scope: 'col', className: 'px-6 py-3 text-right text-xs font-medium text-gray-500 uppercase tracking-wider' }, 'ê°€ìš©ì¬ê³ '),
                React.createElement('th', { scope: 'col', className: 'px-6 py-3 text-right text-xs font-medium text-gray-500 uppercase tracking-wider' }, 'ì¼í‰ê·  íŒë§¤'),
                React.createElement('th', { scope: 'col', className: 'px-6 py-3 text-right text-xs font-medium text-gray-500 uppercase tracking-wider' }, 'ì˜ˆìƒ ì†Œì§„ì¼ (ì¬ê³ ìˆ˜ì¤€)'),
                React.createElement('th', { scope: 'col', className: 'px-6 py-3 text-center text-xs font-medium text-gray-500 uppercase tracking-wider' }, 'ìƒíƒœ')
              )
            ),
            React.createElement('tbody', { className: 'bg-white divide-y divide-gray-200' },
              sortedProducts.map((product) => {
                const availableStock = product.currentStock;
                const maxDays = 30;
                let percentage = 0;
                if (availableStock > 0 && product.averageDailySales === 0) {
                  percentage = 100;
                } else if (product.daysUntilEmpty !== Infinity) {
                  percentage = Math.min((product.daysUntilEmpty / maxDays) * 100, 100);
                }
                return React.createElement('tr', {
                  key: product.id,
                  onClick: () => onSelectProduct(product),
                  className: `cursor-pointer transition-colors hover:bg-gray-50 ${selectedProductId === product.id ? 'bg-indigo-50 hover:bg-indigo-100' : ''}`
                },
                  React.createElement('td', { className: 'px-6 py-4 whitespace-nowrap' },
                    React.createElement('div', { className: 'flex flex-col' },
                      React.createElement('span', { className: 'text-sm font-medium text-gray-900' }, product.name),
                      React.createElement('span', { className: 'text-xs text-gray-500' }, product.category)
                    )
                  ),
                  React.createElement('td', { className: 'px-6 py-4 whitespace-nowrap text-right text-sm text-gray-900 font-medium' },
                    availableStock.toLocaleString()
                  ),
                  React.createElement('td', { className: 'px-6 py-4 whitespace-nowrap text-right text-sm text-gray-500' },
                    `${product.averageDailySales.toFixed(1)}ê°œ`
                  ),
                  React.createElement('td', { className: 'px-6 py-4 whitespace-nowrap text-right' },
                    React.createElement('div', { className: 'flex flex-col items-end gap-1.5' },
                      React.createElement('div', { className: 'text-sm text-gray-900 font-medium' },
                        product.predictedEmptyDate || '-'
                      ),
                      product.daysUntilEmpty !== Infinity && availableStock > 0 ? React.createElement('div', { className: 'flex items-center gap-2' },
                        React.createElement('span', { className: 'text-xs text-gray-500 tabular-nums' },
                          `${product.daysUntilEmpty.toFixed(0)}ì¼ ë‚¨ìŒ`
                        ),
                        React.createElement('div', { className: 'w-20 h-2 bg-gray-100 rounded-full overflow-hidden' },
                          React.createElement('div', {
                            className: `h-full rounded-full transition-all duration-500 ${getBarColor(product.status)}`,
                            style: { width: `${percentage}%` }
                          })
                        )
                      ) : availableStock === 0 ? React.createElement('span', { className: 'text-xs text-red-500 font-medium' }, 'ì¬ê³  ì—†ìŒ') : React.createElement('span', { className: 'text-xs text-emerald-600 font-medium' }, 'ì¬ê³  ì¶©ë¶„')
                    )
                  ),
                  React.createElement('td', { className: 'px-6 py-4 whitespace-nowrap text-center' },
                    React.createElement(StockStatusBadge, { status: product.status })
                  )
                );
              })
            )
          )
        )
      );
    };

    // SalesChart ì»´í¬ë„ŒíŠ¸ (SVG ê¸°ë°˜)
    const SalesChart = ({ product }) => {
      const chartData = useMemo(() => {
        if (!product) return [];
        const sortedHistory = [...product.salesHistory].sort((a, b) => new Date(a.date).getTime() - new Date(b.date).getTime());
        const historyPoints = [];
        const availableStock = product.currentStock;
        let runningStock = availableStock;
        historyPoints.push({ date: 'ì˜¤ëŠ˜', rawDate: new Date().toISOString().split('T')[0], stock: availableStock, type: 'history' });
        [...sortedHistory].reverse().forEach(sale => {
          runningStock += sale.quantity;
          historyPoints.unshift({ date: sale.date.slice(5), rawDate: sale.date, stock: runningStock, type: 'history' });
        });
        const forecastPoints = [];
        const totalSales = product.salesHistory.reduce((acc, curr) => acc + curr.quantity, 0);
        const days = product.salesHistory.length;
        const baseAverageDailySales = days > 0 ? totalSales / days : 0;
        const today = new Date();
        today.setHours(0, 0, 0, 0);
        const todayStr = today.toISOString().split('T')[0];
        const sortedReorderSchedule = (product.reorderSchedule || []).filter(r => r.date >= todayStr).sort((a, b) => a.date.localeCompare(b.date));
        if (baseAverageDailySales > 0 && (availableStock > 0 || sortedReorderSchedule.length > 0)) {
          let currentForecastStock = availableStock;
          let dayOffset = 1;
          let reorderIndex = 0;
          let hasReachedZero = false;
          const maxDays = 365;
          while (dayOffset <= maxDays && !hasReachedZero) {
            const nextDate = new Date(today);
            nextDate.setDate(today.getDate() + dayOffset);
            const nextDateStr = nextDate.toISOString().split('T')[0];
            const hasReorderToday = sortedReorderSchedule.some(r => r.date === nextDateStr);
            while (reorderIndex < sortedReorderSchedule.length) {
              const reorder = sortedReorderSchedule[reorderIndex];
              if (reorder.date < nextDateStr) {
                reorderIndex++;
              } else if (reorder.date === nextDateStr) {
                currentForecastStock += reorder.quantity;
                reorderIndex++;
              } else {
                break;
              }
            }
            let dailySales = 0;
            let stockValue = currentForecastStock;
            if (!hasReorderToday && currentForecastStock > 0) {
              const currentStockRatio = Math.min(1.5, 1 + (currentForecastStock / 100));
              const calculatedDailySales = baseAverageDailySales * currentStockRatio;
              dailySales = Math.min(calculatedDailySales, currentForecastStock);
              currentForecastStock -= dailySales;
              stockValue = currentForecastStock;
            }
            stockValue = Math.max(0, Math.round(stockValue));
            forecastPoints.push({ date: `+${dayOffset}ì¼`, rawDate: nextDateStr, stock: stockValue, type: 'forecast', hasReorder: sortedReorderSchedule.some(r => r.date === nextDateStr), dailySales });
            if (stockValue === 0 && reorderIndex >= sortedReorderSchedule.length) {
              hasReachedZero = true;
              break;
            }
            dayOffset++;
          }
        }
        return [...historyPoints, ...forecastPoints];
      }, [product]);

      if (!product) {
        return React.createElement('div', { className: 'h-full flex items-center justify-center text-gray-400 bg-gray-50 rounded-lg border border-dashed border-gray-200' },
          React.createElement('p', { className: 'text-sm text-center' }, 'ëª©ë¡ì—ì„œ ìƒí’ˆì„ ì„ íƒí•˜ì—¬', React.createElement('br'), 'ì¬ê³  ì†Œì§„ ì˜ˆì¸¡ ê·¸ë˜í”„ë¥¼ í™•ì¸í•˜ì„¸ìš”.')
        );
      }

      return React.createElement('div', { className: 'w-full h-full p-6 flex flex-col' },
        React.createElement('div', { className: 'flex items-center justify-between mb-2' },
          React.createElement('div', {},
            React.createElement('h3', { className: 'text-lg font-bold text-gray-900' }, 'ì¬ê³  ë³€ë™ ë° ì˜ˆì¸¡'),
            React.createElement('p', { className: 'text-xs text-gray-500 mt-1' }, 'ê³¼ê±° ì¬ê³  ì¶”ì´ì™€ í–¥í›„ ì†Œì§„ ì˜ˆìƒì„ ')
          ),
          React.createElement('div', { className: 'text-right' },
            React.createElement('div', { className: 'text-xl font-bold text-indigo-600' }, product.predictedEmptyDate || 'ì¶©ë¶„'),
            React.createElement('div', { className: 'text-xs text-gray-500' }, 'ì˜ˆìƒ ì†Œì§„ì¼')
          )
        ),
        React.createElement('div', { className: 'flex-1 min-h-0 w-full', style: { minHeight: '400px' } },
          (() => {
            if (chartData.length === 0) {
              return React.createElement('div', { className: 'h-full flex items-center justify-center text-gray-400' }, 'ë°ì´í„°ê°€ ì—†ìŠµë‹ˆë‹¤.');
            }
            const width = 800;
            const height = 400;
            const padding = { top: 20, right: 30, bottom: 60, left: 60 };
            const chartWidth = width - padding.left - padding.right;
            const chartHeight = height - padding.top - padding.bottom;
            const maxStock = Math.max(...chartData.map(d => d.stock), 1);
            const minStock = Math.min(...chartData.map(d => d.stock), 0);
            const stockRange = maxStock - minStock || 1;
            const todayIndex = chartData.findIndex(d => d.date === 'ì˜¤ëŠ˜');
            const getX = (index) => padding.left + (index / (chartData.length - 1)) * chartWidth;
            const getY = (stock) => padding.top + chartHeight - ((stock - minStock) / stockRange) * chartHeight;
            const points = chartData.map((d, i) => `${getX(i)},${getY(d.stock)}`).join(' ');
            const areaPoints = `${padding.left},${padding.top + chartHeight} ${points} ${padding.left + chartWidth},${padding.top + chartHeight}`;
            return React.createElement('svg', { width: '100%', height: '100%', viewBox: `0 0 ${width} ${height}`, style: { maxHeight: '400px' } },
              React.createElement('defs', {},
                React.createElement('linearGradient', { id: 'colorStock', x1: '0%', y1: '0%', x2: '0%', y2: '100%' },
                  React.createElement('stop', { offset: '0%', stopColor: '#4f46e5', stopOpacity: 0.3 }),
                  React.createElement('stop', { offset: '100%', stopColor: '#f43f5e', stopOpacity: 0.1 })
                )
              ),
              React.createElement('g', {},
                chartData.map((d, i) => {
                  if (i % Math.ceil(chartData.length / 10) !== 0 && i !== chartData.length - 1) return null;
                  const x = getX(i);
                  return React.createElement('g', { key: i },
                    React.createElement('line', { x1: x, y1: padding.top, x2: x, y2: padding.top + chartHeight, stroke: '#f3f4f6', strokeDasharray: '3 3', strokeWidth: 1 }),
                    React.createElement('text', { x: x, y: padding.top + chartHeight + 20, textAnchor: 'middle', fontSize: '10', fill: '#6b7280', transform: `rotate(-45 ${x} ${padding.top + chartHeight + 20})` }, d.date.length > 8 ? d.date.substring(0, 8) : d.date)
                  );
                })
              ),
              React.createElement('g', {},
                [0, 0.25, 0.5, 0.75, 1].map(ratio => {
                  const y = padding.top + chartHeight - ratio * chartHeight;
                  const value = Math.round(minStock + ratio * stockRange);
                  return React.createElement('g', { key: ratio },
                    React.createElement('line', { x1: padding.left, y1: y, x2: padding.left + chartWidth, y2: y, stroke: '#f3f4f6', strokeDasharray: '3 3', strokeWidth: 1 }),
                    React.createElement('text', { x: padding.left - 10, y: y + 4, textAnchor: 'end', fontSize: '10', fill: '#6b7280' }, value.toLocaleString())
                  );
                })
              ),
              React.createElement('polygon', { points: areaPoints, fill: 'url(#colorStock)', stroke: 'none' }),
              React.createElement('polyline', { points: points, fill: 'none', stroke: '#4f46e5', strokeWidth: 2 }),
              todayIndex >= 0 && React.createElement('line', { x1: getX(todayIndex), y1: padding.top, x2: getX(todayIndex), y2: padding.top + chartHeight, stroke: '#6366f1', strokeDasharray: '3 3', strokeWidth: 2 }),
              chartData.map((d, i) => {
                if (d.hasReorder) {
                  const x = getX(i);
                  const y = getY(d.stock);
                  return React.createElement('g', { key: `reorder-${i}` },
                    React.createElement('circle', { cx: x, cy: y, r: 4, fill: '#10b981', stroke: 'white', strokeWidth: 2 }),
                    React.createElement('text', { x: x, y: y - 10, textAnchor: 'middle', fontSize: '9', fill: '#10b981', fontWeight: 'bold' }, 'ì…ê³ ')
                  );
                }
                return null;
              })
            );
          })()
        )
      );
    };

    // AIAnalysis ì»´í¬ë„ŒíŠ¸ (ê°„ì†Œí™” - API ì—†ì´)
    const AIAnalysis = ({ products }) => {
      const [analysis, setAnalysis] = useState('');
      const handleAnalyze = () => {
        if (products.length === 0) {
          setAnalysis('âš ï¸ ë¶„ì„í•  ìƒí’ˆ ë°ì´í„°ê°€ ì—†ìŠµë‹ˆë‹¤.');
          return;
        }
        const critical = products.filter(p => p.status === StockLevel.CRITICAL || p.status === StockLevel.OUT_OF_STOCK);
        const warning = products.filter(p => p.status === StockLevel.WARNING);
        let report = '# ì¬ê³  ë¶„ì„ ë¦¬í¬íŠ¸\n\n';
        if (critical.length > 0) {
          report += `## âš ï¸ ê¸´ê¸‰ ì¡°ì¹˜ í•„ìš” (${critical.length}ê°œ)\n\n`;
          critical.forEach(p => {
            report += `- **${p.name}**: ì¬ê³  ${p.currentStock}ê°œ, ${p.daysUntilEmpty === Infinity ? 'ì¬ê³  ì¶©ë¶„' : `${p.daysUntilEmpty}ì¼ í›„ ì†Œì§„ ì˜ˆìƒ`}\n`;
          });
          report += '\n';
        }
        if (warning.length > 0) {
          report += `## âš ï¸ ì£¼ì˜ í•„ìš” (${warning.length}ê°œ)\n\n`;
          warning.forEach(p => {
            report += `- **${p.name}**: ì¬ê³  ${p.currentStock}ê°œ, ${p.daysUntilEmpty}ì¼ í›„ ì†Œì§„ ì˜ˆìƒ\n`;
          });
          report += '\n';
        }
        const topSellers = [...products].sort((a, b) => b.averageDailySales - a.averageDailySales).slice(0, 3);
        report += `## ğŸ“ˆ íŒë§¤ëŸ‰ ìƒìœ„ 3ê°œ\n\n`;
        topSellers.forEach((p, i) => {
          report += `${i + 1}. **${p.name}**: ì¼í‰ê·  ${p.averageDailySales.toFixed(1)}ê°œ\n`;
        });
        setAnalysis(report);
      };
      return React.createElement('div', { className: 'bg-white rounded-xl shadow-sm border border-indigo-100 p-6 flex flex-col h-full' },
        React.createElement('div', { className: 'flex items-center justify-between mb-4' },
          React.createElement('div', { className: 'flex items-center gap-2' },
            React.createElement('div', { className: 'p-2 bg-indigo-50 rounded-lg' },
              React.createElement(Sparkles, { className: 'w-5 h-5 text-indigo-600' })
            ),
            React.createElement('h2', { className: 'text-lg font-semibold text-gray-900' }, 'ì¬ê³  ë¶„ì„')
          ),
          React.createElement('button', {
            onClick: handleAnalyze,
            className: 'flex items-center gap-2 px-3 py-1.5 bg-indigo-600 text-white rounded-lg hover:bg-indigo-700 transition-colors text-xs font-medium'
          }, React.createElement(RefreshCw, { className: 'w-3.5 h-3.5' }), analysis ? 'ì¬ë¶„ì„' : 'ë¶„ì„ ì‹¤í–‰')
        ),
        React.createElement('div', { className: 'flex-1 min-h-[120px]' },
          !analysis ? React.createElement('div', { className: 'h-full flex items-center justify-center text-gray-400 bg-gray-50 rounded-lg border border-dashed border-gray-200 p-4' },
            React.createElement('p', { className: 'text-xs text-center' }, 'ì „ì²´ ì¬ê³  ë°ì´í„°ë¥¼ ë¶„ì„í•˜ì—¬', React.createElement('br'), 'ìµœì í™” ë¦¬í¬íŠ¸ë¥¼ ìƒì„±í•©ë‹ˆë‹¤.')
          ) : React.createElement('div', { className: 'prose prose-sm max-w-none text-gray-700 bg-gray-50 p-4 rounded-lg border border-gray-200 h-full overflow-y-auto text-sm' },
            React.createElement('div', { className: 'whitespace-pre-wrap font-sans leading-relaxed' }, analysis)
          )
        )
      );
    };

    // AddProductModal ì»´í¬ë„ŒíŠ¸
    const AddProductModal = ({ isOpen, onClose, onAdd }) => {
      const [formData, setFormData] = useState({ name: '', category: 'ê¸°íƒ€', currentStock: 0, price: 0, avgDailySales: 0 });
      if (!isOpen) return null;
      const handleSubmit = (e) => {
        e.preventDefault();
        onAdd(formData);
        onClose();
        setFormData({ name: '', category: 'ê¸°íƒ€', currentStock: 0, price: 0, avgDailySales: 0 });
      };
      const handleChange = (e) => {
        const { name, value } = e.target;
        setFormData(prev => ({ ...prev, [name]: name === 'name' || name === 'category' ? value : Number(value) }));
      };
      return React.createElement('div', { className: 'fixed inset-0 z-50 flex items-center justify-center bg-black bg-opacity-50 p-4' },
        React.createElement('div', { className: 'bg-white rounded-xl shadow-xl w-full max-w-md overflow-hidden' },
          React.createElement('div', { className: 'flex items-center justify-between p-4 border-b border-gray-100' },
            React.createElement('h3', { className: 'text-lg font-semibold text-gray-900' }, 'ìƒˆ ìƒí’ˆ ë“±ë¡'),
            React.createElement('button', { onClick: onClose, className: 'text-gray-400 hover:text-gray-500' },
              React.createElement(X, { className: 'w-5 h-5' })
            )
          ),
          React.createElement('form', { onSubmit: handleSubmit, className: 'p-6 space-y-4' },
            React.createElement('div', {},
              React.createElement('label', { className: 'block text-sm font-medium text-gray-700 mb-1' }, 'ìƒí’ˆëª…'),
              React.createElement('input', { type: 'text', name: 'name', required, className: 'w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-indigo-500 focus:border-indigo-500 outline-none transition-all', placeholder: 'ì˜ˆ: ì•„ì´ìŠ¤ ì•„ë©”ë¦¬ì¹´ë…¸', value: formData.name, onChange: handleChange })
            ),
            React.createElement('div', { className: 'grid grid-cols-2 gap-4' },
              React.createElement('div', {},
                React.createElement('label', { className: 'block text-sm font-medium text-gray-700 mb-1' }, 'ì¹´í…Œê³ ë¦¬'),
                React.createElement('select', { name: 'category', className: 'w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-indigo-500 outline-none bg-white', value: formData.category, onChange: handleChange },
                  React.createElement('option', { value: 'ì‹í’ˆ' }, 'ì‹í’ˆ'),
                  React.createElement('option', { value: 'ì£¼ë°©ìš©í’ˆ' }, 'ì£¼ë°©ìš©í’ˆ'),
                  React.createElement('option', { value: 'ì „ìì œí’ˆ' }, 'ì „ìì œí’ˆ'),
                  React.createElement('option', { value: 'ì˜ë¥˜' }, 'ì˜ë¥˜'),
                  React.createElement('option', { value: 'ì‚¬ë¬´ìš©í’ˆ' }, 'ì‚¬ë¬´ìš©í’ˆ'),
                  React.createElement('option', { value: 'ê¸°íƒ€' }, 'ê¸°íƒ€')
                )
              ),
              React.createElement('div', {},
                React.createElement('label', { className: 'block text-sm font-medium text-gray-700 mb-1' }, 'íŒë§¤ ë‹¨ê°€ (ì›)'),
                React.createElement('input', { type: 'number', name: 'price', min: '0', className: 'w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-indigo-500 outline-none', value: formData.price, onChange: handleChange })
              )
            ),
            React.createElement('div', { className: 'grid grid-cols-2 gap-4' },
              React.createElement('div', {},
                React.createElement('label', { className: 'block text-sm font-medium text-gray-700 mb-1' }, 'í˜„ì¬ ì¬ê³ ëŸ‰'),
                React.createElement('input', { type: 'number', name: 'currentStock', min: '0', required, className: 'w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-indigo-500 outline-none', value: formData.currentStock, onChange: handleChange })
              ),
              React.createElement('div', {},
                React.createElement('label', { className: 'block text-sm font-medium text-gray-700 mb-1' }, 'ì¼í‰ê·  íŒë§¤(ì˜ˆìƒ)'),
                React.createElement('input', { type: 'number', name: 'avgDailySales', min: '0', required, className: 'w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-indigo-500 outline-none', value: formData.avgDailySales, onChange: handleChange }),
                React.createElement('p', { className: 'text-xs text-gray-400 mt-1' }, 'â€» ê³¼ê±° íŒë§¤ ì´ë ¥ì´ ìë™ ìƒì„±ë©ë‹ˆë‹¤.')
              )
            ),
            React.createElement('div', { className: 'pt-4 flex gap-3' },
              React.createElement('button', { type: 'button', onClick: onClose, className: 'flex-1 px-4 py-2 text-gray-700 bg-gray-100 rounded-lg hover:bg-gray-200 transition-colors font-medium' }, 'ì·¨ì†Œ'),
              React.createElement('button', { type: 'submit', className: 'flex-1 px-4 py-2 text-white bg-indigo-600 rounded-lg hover:bg-indigo-700 transition-colors font-medium' }, 'ë“±ë¡í•˜ê¸°')
            )
          )
        )
      );
    };

    // ë©”ì¸ App ì»´í¬ë„ŒíŠ¸
    const App = () => {
      const [products, setProducts] = useState([]);
      const [isLoadingData, setIsLoadingData] = useState(true);
      const [allStoresData, setAllStoresData] = useState([]);
      const [districtsData, setDistrictsData] = useState([]);
      const [originalProducts, setOriginalProducts] = useState([]);
      const [selectedProductId, setSelectedProductId] = useState(null);
      const [isModalOpen, setIsModalOpen] = useState(false);

      useEffect(() => {
        const loadData = async () => {
          try {
            let originalProductsData = MIYAWNG_BINI_DATA.map((item) => {
              const colorCode = extractColorCode(item.name);
              const warehouseStock = colorCode ? WAREHOUSE_STOCK[colorCode] : undefined;
              const reorderSchedule = colorCode ? REORDER_SCHEDULE[colorCode] : undefined;
              return { ...item, salesHistory: item.salesHistory || [], warehouseStock, reorderSchedule };
            });
            setOriginalProducts(originalProductsData);
            const storesData = ALL_STORES_DATA.stores || [];
            const districts = ALL_STORES_DATA.districts || [];
            setAllStoresData(storesData);
            setDistrictsData(districts);
            const aggregatedProducts = aggregateAllStoresData(storesData, originalProductsData);
            setProducts(aggregatedProducts);
          } catch (error) {
            console.error('Error loading data:', error);
            setProducts([]);
          } finally {
            setIsLoadingData(false);
          }
        };
        loadData();
      }, []);

      const generateSyntheticHistory = (avgSales) => {
        const history = [];
        const today = new Date();
        for (let i = 29; i >= 0; i--) {
          const date = new Date(today);
          date.setDate(date.getDate() - i);
          const variance = Math.max(1, Math.floor(avgSales * 0.3));
          const quantity = Math.max(0, Math.floor(avgSales + (Math.random() * variance * 2 - variance)));
          history.push({ date: date.toISOString().split('T')[0], quantity });
        }
        return history;
      };

      const handleAddProduct = (data) => {
        const newProduct = {
          id: `P${Date.now()}`,
          name: data.name,
          category: data.category,
          currentStock: data.currentStock,
          price: data.price,
          salesHistory: generateSyntheticHistory(data.avgDailySales)
        };
        setProducts(prev => [newProduct, ...prev]);
      };

      const handleDeleteProduct = (id) => {
        if (window.confirm('ì •ë§ ì´ ìƒí’ˆì„ ì‚­ì œí•˜ì‹œê² ìŠµë‹ˆê¹Œ?')) {
          setProducts(prev => prev.filter(p => p.id !== id));
          if (selectedProductId === id) setSelectedProductId(null);
        }
      };

      const handleClearAll = () => {
        if (window.confirm('ëª¨ë“  ë°ì´í„°ë¥¼ ì‚­ì œí•˜ì‹œê² ìŠµë‹ˆê¹Œ? ì´ ì‘ì—…ì€ ë˜ëŒë¦´ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.')) {
          setProducts([]);
          setSelectedProductId(null);
        }
      };

      const forecastData = useMemo(() => {
        return products.map(product => {
          const totalSales = product.salesHistory.reduce((acc, curr) => acc + curr.quantity, 0);
          const days = product.salesHistory.length;
          const averageDailySales = days > 0 ? totalSales / days : 0;
          const availableStock = product.currentStock;
          let predictedEmptyDate = null;
          let daysUntilEmpty = Infinity;
          const today = new Date();
          today.setHours(0, 0, 0, 0);
          const todayStr = today.toISOString().split('T')[0];
          const sortedReorderSchedule = (product.reorderSchedule || []).filter(r => r.date >= todayStr).sort((a, b) => a.date.localeCompare(b.date));
          if (averageDailySales > 0) {
            const firstReorderDate = sortedReorderSchedule.length > 0 ? sortedReorderSchedule[0].date : null;
            let stockBeforeReorder = availableStock;
            let willRunOutBeforeReorder = false;
            if (firstReorderDate && availableStock > 0) {
              const firstReorderDateObj = new Date(firstReorderDate);
              const daysUntilFirstReorder = Math.ceil((firstReorderDateObj.getTime() - today.getTime()) / (1000 * 60 * 60 * 24));
              for (let d = 1; d <= daysUntilFirstReorder && stockBeforeReorder > 0; d++) {
                let dailySales = 0;
                if (stockBeforeReorder > 0) {
                  const stockRatio = Math.min(1.5, 1 + (stockBeforeReorder / 100));
                  const calculatedDailySales = averageDailySales * stockRatio;
                  dailySales = Math.min(calculatedDailySales, stockBeforeReorder);
                  stockBeforeReorder -= dailySales;
                }
              }
              willRunOutBeforeReorder = stockBeforeReorder <= 0;
            }
            let currentStock = willRunOutBeforeReorder && firstReorderDate ? 0 : availableStock;
            let dayOffset = 1;
            let reorderIndex = 0;
            const maxDays = 365;
            let hasFoundEmptyDate = false;
            while (dayOffset <= maxDays && !hasFoundEmptyDate) {
              const nextDate = new Date(today);
              nextDate.setDate(today.getDate() + dayOffset);
              const nextDateStr = nextDate.toISOString().split('T')[0];
              while (reorderIndex < sortedReorderSchedule.length && sortedReorderSchedule[reorderIndex].date <= nextDateStr) {
                const reorder = sortedReorderSchedule[reorderIndex];
                if (willRunOutBeforeReorder && reorder.date === firstReorderDate) {
                  currentStock = reorder.quantity;
                } else {
                  currentStock += reorder.quantity;
                }
                reorderIndex++;
              }
              let dailySales = 0;
              if (currentStock > 0) {
                const currentStockRatio = Math.min(1.5, 1 + (currentStock / 100));
                const calculatedDailySales = averageDailySales * currentStockRatio;
                dailySales = Math.min(calculatedDailySales, currentStock);
                currentStock -= dailySales;
              }
              if (currentStock <= 0) {
                const hasMoreReorder = reorderIndex < sortedReorderSchedule.length;
                if (!hasMoreReorder) {
                  daysUntilEmpty = dayOffset;
                  predictedEmptyDate = nextDateStr;
                  hasFoundEmptyDate = true;
                  break;
                }
                currentStock = 0;
              }
              dayOffset++;
            }
          } else if (availableStock === 0 && sortedReorderSchedule.length === 0) {
            daysUntilEmpty = 0;
            predictedEmptyDate = todayStr;
          }
          let status = StockLevel.SAFE;
          if (availableStock === 0) {
            status = StockLevel.OUT_OF_STOCK;
          } else if (daysUntilEmpty <= 3) {
            status = StockLevel.CRITICAL;
          } else if (daysUntilEmpty <= 7) {
            status = StockLevel.WARNING;
          }
          return { ...product, averageDailySales, daysUntilEmpty, predictedEmptyDate, status };
        });
      }, [products]);

      const selectedProduct = useMemo(() => forecastData.find(p => p.id === selectedProductId) || null, [forecastData, selectedProductId]);

      const stats = useMemo(() => ({
        totalProducts: forecastData.length,
        lowStock: forecastData.filter(p => p.status === StockLevel.WARNING || p.status === StockLevel.CRITICAL).length,
        critical: forecastData.filter(p => p.status === StockLevel.CRITICAL || p.status === StockLevel.OUT_OF_STOCK).length
      }), [forecastData]);

      return React.createElement('div', { className: 'min-h-screen bg-gray-50 flex flex-col' },
        React.createElement('header', { className: 'bg-white border-b border-gray-200 sticky top-0 z-10' },
          React.createElement('div', { className: 'max-w-7xl mx-auto px-4 sm:px-6 lg:px-8' },
            React.createElement('div', { className: 'flex justify-between h-16' },
              React.createElement('div', { className: 'flex items-center' },
                React.createElement(LayoutDashboard, { className: 'h-6 w-6 text-indigo-600 mr-3' }),
                React.createElement('h1', { className: 'text-xl font-bold text-gray-900 hidden sm:block' }, 'ì¬ê³  ì˜ˆì¸¡ ëŒ€ì‹œë³´ë“œ'),
                React.createElement('h1', { className: 'text-xl font-bold text-gray-900 sm:hidden' }, 'ì¬ê³  ì˜ˆì¸¡')
              ),
              React.createElement('div', { className: 'flex items-center gap-2' },
                products.length > 0 && React.createElement(React.Fragment, {},
                  React.createElement('button', { onClick: handleClearAll, className: 'px-3 py-2 text-sm text-gray-500 hover:text-red-600 transition-colors' }, 'ì´ˆê¸°í™”'),
                  React.createElement('button', {
                    onClick: () => {
                      const loadedProducts = MIYAWNG_BINI_DATA.map((item) => {
                        const colorCode = extractColorCode(item.name);
                        const warehouseStock = colorCode ? WAREHOUSE_STOCK[colorCode] : undefined;
                        const reorderSchedule = colorCode ? REORDER_SCHEDULE[colorCode] : undefined;
                        return { ...item, salesHistory: item.salesHistory || [], warehouseStock, reorderSchedule };
                      });
                      setProducts(loadedProducts);
                    },
                    className: 'px-3 py-2 text-sm text-gray-500 hover:text-indigo-600 transition-colors flex items-center gap-1',
                    title: 'ë¯¸ì•¼ì˜¹ë¹„ë‹ˆ ë°ì´í„° ë‹¤ì‹œ ë¡œë“œ'
                  }, React.createElement(Upload, { className: 'w-4 h-4' }), React.createElement('span', { className: 'hidden sm:inline' }, 'ë°ì´í„° ì¬ë¡œë“œ'))
                ),
                React.createElement('button', {
                  onClick: () => setIsModalOpen(true),
                  className: 'flex items-center gap-2 bg-indigo-600 hover:bg-indigo-700 text-white px-4 py-2 rounded-lg text-sm font-medium transition-colors shadow-sm'
                }, React.createElement(Plus, { className: 'w-4 h-4' }), React.createElement('span', { className: 'hidden sm:inline' }, 'ìƒí’ˆ ë“±ë¡'), React.createElement('span', { className: 'sm:hidden' }, 'ë“±ë¡'))
              )
            )
          )
        ),
        React.createElement('main', { className: 'flex-1 max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-8 w-full' },
          isLoadingData ? React.createElement('div', { className: 'text-center py-8 text-gray-500' }, 'ë°ì´í„° ë¡œë”© ì¤‘...') : React.createElement(React.Fragment, {},
            React.createElement('div', { className: 'grid grid-cols-1 md:grid-cols-3 gap-6 mb-8' },
              React.createElement('div', { className: 'bg-white p-6 rounded-xl shadow-sm border border-gray-100 flex items-center' },
                React.createElement('div', { className: 'p-3 rounded-full bg-blue-100 mr-4' },
                  React.createElement(Package, { className: 'h-6 w-6 text-blue-600' })
                ),
                React.createElement('div', {},
                  React.createElement('p', { className: 'text-sm font-medium text-gray-500' }, 'ì´ ê´€ë¦¬ ìƒí’ˆ'),
                  React.createElement('p', { className: 'text-2xl font-bold text-gray-900' }, `${stats.totalProducts}ê°œ`)
                )
              ),
              React.createElement('div', { className: 'bg-white p-6 rounded-xl shadow-sm border border-gray-100 flex items-center' },
                React.createElement('div', { className: 'p-3 rounded-full bg-amber-100 mr-4' },
                  React.createElement(AlertCircle, { className: 'h-6 w-6 text-amber-600' })
                ),
                React.createElement('div', {},
                  React.createElement('p', { className: 'text-sm font-medium text-gray-500' }, 'ì¬ê³  ë¶€ì¡± ì£¼ì˜'),
                  React.createElement('p', { className: 'text-2xl font-bold text-amber-600' }, `${stats.lowStock}ê°œ`)
                )
              ),
              React.createElement('div', { className: 'bg-white p-6 rounded-xl shadow-sm border border-gray-100 flex items-center' },
                React.createElement('div', { className: 'p-3 rounded-full bg-rose-100 mr-4' },
                  React.createElement(AlertCircle, { className: 'h-6 w-6 text-rose-600' })
                ),
                React.createElement('div', {},
                  React.createElement('p', { className: 'text-sm font-medium text-gray-500' }, 'í’ˆì ˆ ì„ë°•/ìœ„í—˜'),
                  React.createElement('p', { className: 'text-2xl font-bold text-rose-600' }, `${stats.critical}ê°œ`)
                )
              )
            ),
            products.length === 0 ? React.createElement('div', { className: 'bg-white rounded-xl shadow-sm border border-dashed border-gray-300 p-12 text-center' },
              React.createElement(Package, { className: 'w-12 h-12 text-gray-300 mx-auto mb-4' }),
              React.createElement('h3', { className: 'text-lg font-medium text-gray-900 mb-2' }, 'ë“±ë¡ëœ ìƒí’ˆì´ ì—†ìŠµë‹ˆë‹¤'),
              React.createElement('p', { className: 'text-gray-500 mb-6' }, 'ìƒˆë¡œìš´ ìƒí’ˆì„ ë“±ë¡í•˜ì—¬ ì¬ê³  ê´€ë¦¬ë¥¼ ì‹œì‘í•´ë³´ì„¸ìš”.'),
              React.createElement('button', {
                onClick: () => setIsModalOpen(true),
                className: 'inline-flex items-center gap-2 bg-indigo-600 hover:bg-indigo-700 text-white px-5 py-2.5 rounded-lg font-medium transition-colors shadow-sm'
              }, React.createElement(Plus, { className: 'w-5 h-5' }), 'ì²« ìƒí’ˆ ë“±ë¡í•˜ê¸°')
            ) : React.createElement('div', { className: 'grid grid-cols-1 lg:grid-cols-3 gap-8' },
              React.createElement('div', { className: 'lg:col-span-2 flex flex-col gap-6' },
                React.createElement('div', { className: 'flex items-center justify-between' },
                  React.createElement('h2', { className: 'text-lg font-semibold text-gray-900' }, 'ì¬ê³  í˜„í™© ë° ì˜ˆì¸¡')
                ),
                React.createElement('div', { className: 'flex-1 min-h-[500px]' },
                  React.createElement(InventoryTable, {
                    products: forecastData,
                    onSelectProduct: (p) => setSelectedProductId(p.id),
                    selectedProductId: selectedProductId
                  })
                )
              ),
              React.createElement('div', { className: 'flex flex-col gap-6' },
                React.createElement('div', { className: 'bg-white rounded-xl shadow-sm border border-gray-200 p-1 min-h-[500px] relative' },
                  selectedProductId && React.createElement('button', {
                    onClick: () => handleDeleteProduct(selectedProductId),
                    className: 'absolute top-4 right-4 p-2 text-gray-400 hover:text-red-500 hover:bg-red-50 rounded-lg transition-colors z-10',
                    title: 'ì´ ìƒí’ˆ ì‚­ì œ'
                  }, React.createElement(Trash2, { className: 'w-4 h-4' })),
                  React.createElement(SalesChart, { product: selectedProduct })
                ),
                selectedProduct && React.createElement('div', { className: 'bg-white rounded-xl shadow-sm border border-gray-200 p-4 text-xs text-gray-600' },
                  React.createElement('div', { className: 'font-semibold text-gray-700 mb-2' }, 'ğŸ“Š ì†Œì§„ ì˜ˆì¸¡ ê³„ì‚° ë¡œì§'),
                  React.createElement('div', { className: 'space-y-1' },
                    React.createElement('div', {}, 'â€¢ ', React.createElement('strong', {}, 'ê¸°ë³¸ ì¼í‰ê·  íŒë§¤ëŸ‰:'), ' ê³¼ê±° íŒë§¤ ì´ë ¥ì˜ í‰ê· ê°’'),
                    React.createElement('div', {}, 'â€¢ ', React.createElement('strong', {}, 'ë™ì  íŒë§¤ëŸ‰ ì¡°ì •:'), ' ì¬ê³ ê°€ ë§ì„ìˆ˜ë¡ íŒë§¤ëŸ‰ ì¦ê°€ (ìµœëŒ€ 1.5ë°°), ì¬ê³  ë¶€ì¡± ì‹œ ê°ì†Œ (0.3ë°°)'),
                    React.createElement('div', {}, 'â€¢ ', React.createElement('strong', {}, 'ì¼ì¼ ì¬ê³  ë³€í™”:'), ' ì „ì¼ ì¬ê³  + ì…ê³ ëŸ‰ - ì¼ì¼ íŒë§¤ëŸ‰'),
                    React.createElement('div', {}, 'â€¢ ', React.createElement('strong', {}, 'ì…ê³  ì¼ì • ë°˜ì˜:'), ' ì˜ˆì •ëœ ì…ê³  ì¼ì •ì— ë”°ë¼ ì¬ê³  ì¦ê°€'),
                    React.createElement('div', {}, 'â€¢ ', React.createElement('strong', {}, 'ì†Œì§„ì¼ ê³„ì‚°:'), ' ì…ê³  ì¼ì •ê³¼ ë™ì  íŒë§¤ëŸ‰ì„ ë°˜ì˜í•˜ì—¬ ì¬ê³ ê°€ 0ì´ ë˜ëŠ” ì‹œì  ê³„ì‚°'),
                    selectedProduct.reorderSchedule && selectedProduct.reorderSchedule.length > 0 && React.createElement('div', { className: 'mt-2 pt-2 border-t border-gray-300' },
                      React.createElement('div', { className: 'font-semibold text-gray-700' }, 'ğŸ“¦ ì…ê³  ì¼ì •:'),
                      selectedProduct.reorderSchedule.map((reorder, idx) =>
                        React.createElement('div', { key: idx, className: 'ml-2' }, `${reorder.date}: +${reorder.quantity.toLocaleString()}ê°œ`)
                      )
                    )
                  )
                ),
                React.createElement(AIAnalysis, { products: forecastData })
              )
            )
          )
        ),
        React.createElement(AddProductModal, {
          isOpen: isModalOpen,
          onClose: () => setIsModalOpen(false),
          onAdd: handleAddProduct
        })
      );
    };

    // ë Œë”ë§
    const renderApp = () => {
      try {
        console.log('ì•± ë Œë”ë§ ì‹œì‘...');
        // React 18 ë°©ì‹ ì‹œë„
        if (ReactDOM.createRoot) {
          const root = ReactDOM.createRoot(document.getElementById('root'));
          root.render(React.createElement(App));
          console.log('React 18 ë°©ì‹ìœ¼ë¡œ ë Œë”ë§ ì™„ë£Œ');
        } else {
          // React 17 ë°©ì‹ (fallback)
          ReactDOM.render(React.createElement(App), document.getElementById('root'));
          console.log('React 17 ë°©ì‹ìœ¼ë¡œ ë Œë”ë§ ì™„ë£Œ');
        }
      } catch (error) {
        console.error('ë Œë”ë§ ì˜¤ë¥˜:', error);
        document.getElementById('root').innerHTML = `
          <div style="padding: 20px; text-align: center; font-family: sans-serif;">
            <h2 style="color: #ef4444;">ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤</h2>
            <p>ë¸Œë¼ìš°ì € ì½˜ì†”(F12)ì„ ì—´ì–´ ì˜¤ë¥˜ë¥¼ í™•ì¸í•´ì£¼ì„¸ìš”.</p>
            <pre style="text-align: left; background: #f5f5f5; padding: 10px; margin-top: 10px; border-radius: 4px;">${error.toString()}\n${error.stack || ''}</pre>
          </div>
        `;
      }
    };

    if (document.readyState === 'loading') {
      window.addEventListener('DOMContentLoaded', renderApp);
    } else {
      renderApp();
    }
  </script>
</body>
</html>
